# Storybook v9 マイグレーション タスクリスト

## フェーズ1: 自動アップグレード
- [ ] `npx storybook@latest upgrade` コマンドを実行
  - **完了条件**: コマンドが正常終了し、"Storybook has been upgraded"メッセージが表示される
- [ ] アップグレード結果の確認
  - **完了条件**: package.jsonでStorybookパッケージがすべてv9.x.xに統一されている
- [ ] 依存関係の変更内容を確認
  - **完了条件**: 変更されたパッケージリストが表示され、内容を把握できている
- [ ] エラーや警告メッセージの確認
  - **完了条件**: 致命的なエラーがない、または解決方法が明確になっている

## フェーズ2: 設定ファイルの確認・調整
- [ ] `.storybook/main.ts` の内容を確認
  - **完了条件**: 設定内容を確認し、v9での変更点を把握している
- [ ] `.storybook/preview.ts` の内容を確認
  - **完了条件**: 設定内容を確認し、v9での変更点を把握している
- [ ] Essential addonsの重複参照を削除
  - [ ] `@storybook/addon-viewport` の参照を削除（コアに統合済み）
    - **完了条件**: main.tsのaddons配列から削除され、importも不要になっている
  - [ ] `@storybook/addon-actions` の参照を削除（コアに統合済み）
    - **完了条件**: main.tsのaddons配列から削除され、importも不要になっている
- [ ] Import文の調整（必要に応じて）
  - **完了条件**: 統合されたaddonのimport文が正しく変更されている

## フェーズ3: 依存関係の整理
- [ ] package.jsonから不要なaddonパッケージを削除
  - [ ] `@storybook/addon-viewport` を削除
    - **完了条件**: package.jsonのdependencies/devDependenciesから削除されている
  - [ ] `@storybook/addon-actions` を削除
    - **完了条件**: package.jsonのdependencies/devDependenciesから削除されている
  - [ ] その他統合されたaddonパッケージを削除
    - **完了条件**: 統合されたすべてのaddonパッケージが削除されている
- [ ] package.jsonの依存関係を確認
  - **完了条件**: Storybookパッケージのバージョンが一貫している
- [ ] `pnpm install` で依存関係を再インストール
  - **完了条件**: インストールが正常完了し、エラーが発生していない
- [ ] lockファイルの更新確認
  - **完了条件**: pnpm-lock.yamlが更新され、不要なパッケージが削除されている

## フェーズ4: 動作確認
- [ ] `pnpm storybook` でローカル起動確認
  - **完了条件**: Storybookがポート6006で正常に起動し、ブラウザでアクセス可能
- [ ] Storybookの起動ログを確認（エラー・警告なし）
  - **完了条件**: 致命的なエラーがなく、重要な警告が解消されている
- [ ] 各ストーリーファイルの表示確認
  - [ ] Layout/Footer.stories.ts の表示確認
    - **完了条件**: すべてのストーリー（Default、iPhone12ProMax、iPhone5、iPad）が正常に表示される
  - [ ] Layout/Header.stories.ts の表示確認
    - **完了条件**: すべてのストーリーが正常に表示される
  - [ ] Profile/SNS.stories.ts の表示確認
    - **完了条件**: すべてのストーリーが正常に表示される
  - [ ] Profile/index.stories.ts の表示確認
    - **完了条件**: すべてのストーリーが正常に表示される
- [ ] Viewport切り替え機能の動作確認
  - **完了条件**: 各ストーリーでViewportが正常に切り替わり、レスポンシブ表示が機能する
- [ ] Actions（イベント）の動作確認
  - **完了条件**: イベントが発生した際にActionsパネルに正常に記録される
- [ ] `pnpm build-storybook` でビルド確認
  - **完了条件**: ビルドが正常完了し、エラーが発生していない
- [ ] ビルド成果物の確認
  - **完了条件**: storybook-staticディレクトリが作成され、静的ファイルが生成されている

## フェーズ5: Chromatic連携確認
- [ ] `pnpm chromatic` でChromaticデプロイテスト
  - **完了条件**: デプロイが正常完了し、Chromaticのダッシュボードで確認可能
- [ ] デプロイ結果の確認
  - **完了条件**: すべてのストーリーがChromaticで正常に表示される
- [ ] ビジュアルテストの動作確認
  - **完了条件**: 既存のビジュアルテストが正常に動作し、差分検出が機能する

## フェーズ6: プロジェクト全体の動作確認
- [ ] `pnpm build` でNext.jsプロジェクトのビルド確認
  - **完了条件**: エラーなくビルドが完了し、.nextディレクトリが生成される
- [ ] `pnpm test` でテストの実行確認
  - **完了条件**: すべてのテストが正常に実行され、失敗がない
- [ ] `pnpm confirm:lint` でlintの実行確認
  - **完了条件**: Biome lintが正常に実行され、重要なエラーがない
- [ ] `pnpm confirm:spell` でスペルチェック確認
  - **完了条件**: cspellが正常に実行され、重要なスペルエラーがない
- [ ] `pnpm confirm` で全体の品質チェック確認
  - **完了条件**: lint、spellチェックが全て正常に完了する
- [ ] `pnpm codegen` でコード生成の確認
  - **完了条件**: GraphQLとSCSSの型定義が正常に生成される

## 最終確認
- [ ] すべてのnpm scriptsが正常に動作することを確認
  - [ ] `pnpm dev`
    - **完了条件**: 開発サーバーがエラーなく起動する
  - [ ] `pnpm build`
    - **完了条件**: 本番ビルドがエラーなく完了する
  - [ ] `pnpm start`
    - **完了条件**: 本番サーバーがエラーなく起動する
  - [ ] `pnpm test`
    - **完了条件**: すべてのテストが正常に実行される
  - [ ] `pnpm storybook`
    - **完了条件**: エラーなく起動し、ブラウザでアクセス可能
  - [ ] `pnpm build-storybook`
    - **完了条件**: エラーなくビルドが完了する
  - [ ] `pnpm chromatic`
    - **完了条件**: エラーなくデプロイが完了する
  - [ ] `pnpm confirm`
    - **完了条件**: lint、spellチェックが正常に完了する
- [ ] 依存関係の警告が解消されていることを確認
  - **完了条件**: `pnpm install`実行時に重要な警告が表示されない
- [ ] package.jsonのバージョンが統一されていることを確認
  - **完了条件**: すべてのStorybookパッケージがv9.x.xで統一されている
- [ ] 不要なファイルが残っていないことを確認
  - **完了条件**: 古いconfigファイルやキャッシュが削除されている

## トラブルシューティング用
- [ ] 問題発生時のロールバック手順を準備
  - **完了条件**: `git status`で変更ファイルを把握し、復旧手順を確認済み
- [ ] 現在のコミット状況を確認
  - **完了条件**: `git log --oneline -5`で最新のコミットを確認済み
- [ ] バックアップ用のブランチ作成（必要に応じて）
  - **完了条件**: 必要に応じて現在の状態をバックアップブランチに保存済み

## 完了後の清掃
- [ ] 不要になった設定ファイルの削除
  - **完了条件**: 古いStorybookファイルやキャッシュが削除されている
- [ ] task.mdとplan.mdの整理
  - **完了条件**: 完了したタスクにチェックマークが付き、最終状態が記録されている
- [ ] コミットメッセージの準備
  - **完了条件**: マイグレーション内容を適切に説明するコミットメッセージが準備されている
- [ ] ドキュメントの更新（CLAUDE.md等）
  - **完了条件**: 新しいStorybookバージョンに合わせてドキュメントが更新されている