# Storybook v9 マイグレーション タスクリスト

## フェーズ1: 自動アップグレード
- [x] `npx storybook@latest upgrade` コマンドを実行
  - **完了条件**: コマンドが正常終了し、"Storybook has been upgraded"メッセージが表示される
- [x] アップグレード結果の確認
  - **完了条件**: package.jsonでStorybookパッケージがすべてv9.x.xに統一されている
- [x] 依存関係の変更内容を確認
  - **完了条件**: 変更されたパッケージリストが表示され、内容を把握できている
- [x] エラーや警告メッセージの確認
  - **完了条件**: 致命的なエラーがない、または解決方法が明確になっている

## フェーズ2: 設定ファイルの確認・調整
- [x] `.storybook/main.ts` の内容を確認
  - **完了条件**: 設定内容を確認し、v9での変更点を把握している
- [x] `.storybook/preview.ts` の内容を確認
  - **完了条件**: 設定内容を確認し、v9での変更点を把握している
- [x] Essential addonsの重複参照を削除
  - [x] `@storybook/addon-viewport` の参照を削除（コアに統合済み）
    - **完了条件**: main.tsのaddons配列から削除され、importも不要になっている
  - [x] `@storybook/addon-actions` の参照を削除（コアに統合済み）
    - **完了条件**: main.tsのaddons配列から削除され、importも不要になっている
- [x] Import文の調整（必要に応じて）
  - **完了条件**: 統合されたaddonのimport文が正しく変更されている

## フェーズ3: 依存関係の整理
- [x] package.jsonから不要なaddonパッケージを削除
  - [x] `@storybook/addon-viewport` を削除
    - **完了条件**: package.jsonのdependencies/devDependenciesから削除されている
  - [x] `@storybook/addon-actions` を削除
    - **完了条件**: package.jsonのdependencies/devDependenciesから削除されている
  - [x] その他統合されたaddonパッケージを削除
    - **完了条件**: 統合されたすべてのaddonパッケージが削除されている
- [x] package.jsonの依存関係を確認
  - **完了条件**: Storybookパッケージのバージョンが一貫している
- [x] `pnpm install` で依存関係を再インストール
  - **完了条件**: インストールが正常完了し、エラーが発生していない
- [x] lockファイルの更新確認
  - **完了条件**: pnpm-lock.yamlが更新され、不要なパッケージが削除されている

## フェーズ4: 動作確認
- [x] `pnpm storybook` でローカル起動確認
  - **完了条件**: Storybookがポート6006で正常に起動し、ブラウザでアクセス可能
- [x] Storybookの起動ログを確認（エラー・警告なし）
  - **完了条件**: 致命的なエラーがなく、重要な警告が解消されている
- [x] 各ストーリーファイルの表示確認
  - [x] Layout/Footer.stories.ts の表示確認
    - **完了条件**: すべてのストーリー（Default、iPhone12ProMax、iPhone5、iPad）が正常に表示される
  - [x] Layout/Header.stories.ts の表示確認
    - **完了条件**: すべてのストーリーが正常に表示される
  - [x] Profile/SNS.stories.ts の表示確認
    - **完了条件**: すべてのストーリーが正常に表示される
  - [x] Profile/index.stories.ts の表示確認
    - **完了条件**: すべてのストーリーが正常に表示される
- [x] Viewport切り替え機能の動作確認
  - **完了条件**: 各ストーリーでViewportが正常に切り替わり、レスポンシブ表示が機能する
- [x] Actions（イベント）の動作確認
  - **完了条件**: イベントが発生した際にActionsパネルに正常に記録される
- [x] `pnpm build-storybook` でビルド確認
  - **完了条件**: ビルドが正常完了し、エラーが発生していない
- [x] ビルド成果物の確認
  - **完了条件**: storybook-staticディレクトリが作成され、静的ファイルが生成されている

## フェーズ5: Chromatic連携確認
- [x] `pnpm chromatic` でChromaticデプロイテスト
  - **完了条件**: デプロイが正常完了し、Chromaticのダッシュボードで確認可能
- [x] デプロイ結果の確認
  - **完了条件**: すべてのストーリーがChromaticで正常に表示される
- [x] ビジュアルテストの動作確認
  - **完了条件**: 既存のビジュアルテストが正常に動作し、差分検出が機能する

## フェーズ6: プロジェクト全体の動作確認
- [x] `pnpm build` でNext.jsプロジェクトのビルド確認
  - **完了条件**: エラーなくビルドが完了し、.nextディレクトリが生成される
- [x] `pnpm test` でテストの実行確認
  - **完了条件**: すべてのテストが正常に実行され、失敗がない
- [x] `pnpm confirm:lint` でlintの実行確認
  - **完了条件**: Biome lintが正常に実行され、重要なエラーがない
- [x] `pnpm confirm:spell` でスペルチェック確認
  - **完了条件**: cspellが正常に実行され、重要なスペルエラーがない
- [x] `pnpm confirm` で全体の品質チェック確認
  - **完了条件**: lint、spellチェックが全て正常に完了する
- [x] `pnpm codegen` でコード生成の確認
  - **完了条件**: GraphQLとSCSSの型定義が正常に生成される

## 最終確認
- [x] すべてのnpm scriptsが正常に動作することを確認
  - [x] `pnpm dev`
    - **完了条件**: 開発サーバーがエラーなく起動する
  - [x] `pnpm build`
    - **完了条件**: 本番ビルドがエラーなく完了する
  - [x] `pnpm start`
    - **完了条件**: 本番サーバーがエラーなく起動する
  - [x] `pnpm test`
    - **完了条件**: すべてのテストが正常に実行される
  - [x] `pnpm storybook`
    - **完了条件**: エラーなく起動し、ブラウザでアクセス可能
  - [x] `pnpm build-storybook`
    - **完了条件**: エラーなくビルドが完了する
  - [x] `pnpm chromatic`
    - **完了条件**: エラーなくデプロイが完了する
  - [x] `pnpm confirm`
    - **完了条件**: lint、spellチェックが正常に完了する
- [x] 依存関係の警告が解消されていることを確認
  - **完了条件**: `pnpm install`実行時に重要な警告が表示されない
- [x] package.jsonのバージョンが統一されていることを確認
  - **完了条件**: すべてのStorybookパッケージがv9.x.xで統一されている
- [x] 不要なファイルが残っていないことを確認
  - **完了条件**: 古いconfigファイルやキャッシュが削除されている

## トラブルシューティング用
- [x] 問題発生時のロールバック手順を準備
  - **完了条件**: `git status`で変更ファイルを把握し、復旧手順を確認済み
- [x] 現在のコミット状況を確認
  - **完了条件**: `git log --oneline -5`で最新のコミットを確認済み
- [x] バックアップ用のブランチ作成（必要に応じて）
  - **完了条件**: 必要に応じて現在の状態をバックアップブランチに保存済み

## 完了後の清掃
- [x] 不要になった設定ファイルの削除
  - **完了条件**: 古いStorybookファイルやキャッシュが削除されている
- [x] task.mdとplan.mdの整理
  - **完了条件**: 完了したタスクにチェックマークが付き、最終状態が記録されている
- [x] コミットメッセージの準備
  - **完了条件**: マイグレーション内容を適切に説明するコミットメッセージが準備されている
- [x] ドキュメントの更新（CLAUDE.md等）
  - **完了条件**: 新しいStorybookバージョンに合わせてドキュメントが更新されている